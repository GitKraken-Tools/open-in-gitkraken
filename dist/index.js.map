{"version":3,"sources":["../node_modules/pushstate-js/dist/index.js","../src/index.ts","../src/waitForElement.ts","../src/getGkLogo.ts"],"sourcesContent":["var __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\n\n// src/index.ts\nvar src_exports = {};\n__export(src_exports, {\n  default: () => src_default\n});\nmodule.exports = __toCommonJS(src_exports);\nvar initializePushstateEvent = () => {\n  const getCurrentUrl = () => {\n    var _a;\n    return ((_a = window == null ? void 0 : window.location) == null ? void 0 : _a.href) ?? \"\";\n  };\n  let currentUrl = getCurrentUrl();\n  const observer = new MutationObserver(() => {\n    const newUrl = getCurrentUrl();\n    if (newUrl !== currentUrl) {\n      const previousUrl = currentUrl;\n      currentUrl = newUrl;\n      const event = new Event(\"pushstate\", {\n        previous: previousUrl,\n        current: currentUrl\n      });\n      window.dispatchEvent(event);\n      if (typeof window.onpushstate === \"function\") {\n        window.onpushstate(event);\n      }\n    }\n  });\n  observer.observe(document, { subtree: true, childList: true });\n};\nvar src_default = initializePushstateEvent;\n// Annotate the CommonJS export names for ESM import in node:\n0 && (module.exports = {});\n","import initializePushstateEvent from 'pushstate-js';\nimport waitForElement from './waitForElement.js';\nimport getGkLogo from './getGkLogo.js';\n\nconst dropdownLinkClass = 'gk-link';\nconst alreadyInjected = (): boolean => document.getElementsByClassName(dropdownLinkClass).length > 0;\n\nlet cancelRender: (() => void) | undefined = undefined;\n\nconst render = async () => {\n  if (alreadyInjected()) return;\n  console.log();\n  if (typeof cancelRender === 'function') cancelRender(); // Cancel the current render process if it's still running\n  const controller = new AbortController(); // Create a new controller for this render process\n  cancelRender = () => controller.abort(); // Set the cancelRender function to abort the new controller\n  const modal = await waitForElement('div [data-target=\"get-repo.modal\"] ul', controller)[0]; // Wait for the modal element to become available and pass in the abort controller\n\n  const modalChildren = modal ? Array.from(modal.children) : []; // The clone dropdown element\n  if (!modalChildren.length) return; // If no modal children are found, return\n\n  const repoUrl: string = (modalChildren.find(elem => elem.matches('li:first-of-type'))?.querySelector('input[data-autoselect]') as HTMLInputElement)?.value || ''; // The copy link\n  const repoUrlParts = repoUrl.split('/'); // Split the url into parts\n  const numCommits = Number((document.querySelector('svg.octicon-history')?.nextElementSibling?.querySelector('strong')?.textContent ?? '').replace(/,/g, '')); // Extract the number of commits in the repo\n  if (repoUrlParts.length < 4 || numCommits === 0) return; // If the url is invalid, return\n\n  const user = repoUrl.split('/')[3]; // Extract the user from the link\n  const repo = repoUrl.split('/')[4].replace('.git', ''); // Extract the repo name from the link\n  const sha = await getFirstCommit(user, repo, numCommits, controller); // Fetch the first commit\n  if (sha) {\n    const secondFromLast = modalChildren.reverse().find(elem => elem.matches('li:nth-last-child(1)'));\n    if (!secondFromLast || alreadyInjected()) return; // If the link was already added, abort\n    secondFromLast.insertAdjacentHTML('beforebegin', createLink(repoUrl, sha));\n  }\n};\n\nconst getFirstCommit = async (user: string, repo: string, numCommits: number, controller: AbortController) => {\n  if (numCommits === 0) { return null; }\n  const fetchUrl = `https://api.github.com/repos/${user}/${repo}/commits?per_page=1&page=${numCommits}`;\n  return await fetch(fetchUrl, { signal: controller.signal })\n    .then(res => res.json())\n    .catch(error => console.error(`Error fetching ${fetchUrl}\\n${error}`))\n    .then(([commit]) => commit == null ? null : commit.sha);\n};\n\n// adding a `commit` parameter here preliminarily in hopes of one day (soon ðŸ¤žðŸ¼) supporting deep linking to a specific commit\nconst createLink = (repo, sha, commit = '') => {\n  return `<li class=\"Box-row Box-row--hover-gray p-3 mt-0 rounded-0 ${dropdownLinkClass}\">\n    <a target=\"_blank\" href=\"gitkraken://repolink/${sha}${commit ? `/commit/${commit}` : ''}?url=${repo}\" class=\"d-flex flex-items-center color-fg-default text-bold no-underline\">\n      ${getGkLogo({ className: 'mr-2' })} Open in GitKraken\n    </a>\n  </li>`\n};\n\ninitializePushstateEvent();\nrender();\nwindow.addEventListener('pushstate', render);\n\nconst getGitUrl = () => (document.querySelector('meta[name=\"go-import\"]') as HTMLMetaElement)?.content.split(' ')[2] ?? window.location.href ?? '';\n\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  if (message?.subject !== 'request-git-url') return;\n  sendResponse(encodeURIComponent(getGitUrl()));\n});\n\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  if (message?.subject !== 'console-log') return;\n  if (message?.payload) console.log(...message.payload);\n});\n","// built using `waitForElement` function by Paul Kinlan:\n// https://paul.kinlan.me/waiting-for-an-element-to-be-created/\nconst waitForElement = (\n  selector: string,\n  controller = new AbortController(),\n): [Promise<Element>, () => void] => {\n  const promise: Promise<Element> = new Promise((resolve, reject) => {\n    controller.signal.addEventListener('abort', () => {\n      reject();\n    });\n    const element = document.querySelector(selector);\n    if (element) {\n      resolve(element);\n      return;\n    }\n    let timeout: ReturnType<typeof setTimeout>;\n    const observer = new MutationObserver(() => {\n      clearTimeout(timeout);\n      timeout = setTimeout(() => {\n        const element = document.querySelector(selector);\n        if (element) {\n          observer.disconnect();\n          resolve(element);\n          return;\n        }\n      }, 50);\n    });\n    observer.observe(document.documentElement, { childList: true, subtree: true });\n  });\n  const cancel = () => {\n    controller.abort();\n  }\n  return [promise, cancel];\n}\n\nexport default waitForElement;","const darkModeSupported = window.matchMedia('(prefers-color-scheme: dark)').matches;\nconst isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;\nconst gkBrandColor = '#179287';\nconst responsiveColor = `var(--color-fg-default, ${darkModeSupported ? (isDarkMode ? '#fff' : '#000') : gkBrandColor})`;\nconst __getGkLogo_default_options = {\n  fill: responsiveColor,\n  size: 16,\n  className: '',\n};\nconst getGkLogo = (options) => {\n  options = {\n    ...__getGkLogo_default_options,\n    ...options,\n  };\n  const { fill, size, className } = options;\n  return `<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 184 184\" width=\"${size}\" height=\"${size}\" class=\"${className}\" style=\"enable-background:new 0 0 184 184;\" xml:space=\"preserve\">\n    <g>\n      <path style=\"fill: ${fill}\" d=\"M177.2,48.4c-0.8-1.9-2.9-2.7-4.8-2c-1.3,0.5-2.2,1.8-2.2,3.2c0,0.4,0.1,0.9,0.2,1.3\n        c16.3,43.3-5.7,91.6-49,107.9c-6,2.2-12.2,3.8-18.5,4.6v-39.1c2.5-0.5,4.9-1.1,7.3-1.9v32.9c41.3-10.1,66.7-51.7,56.6-93\n        c-5.1-20.9-18.7-38.8-37.6-49.2c-1.8-1-4-0.3-4.9,1.4c0,0-0.1,0.1-0.1,0.1c-0.2,0.5-0.4,1.1-0.4,1.6c0,1.3,0.7,2.5,1.9,3.2\n        c33.7,18.7,45.9,61.1,27.2,94.8c-7.8,14.2-20.4,25.2-35.4,31.1v-29.1c4.6-1.4,7.8-5.7,7.9-10.6c0-4-2-7.6-5.5-9.6\n        c2.6-25.1,14.1-18.5,14.1-26.5v-4.7c0-12-27.8-51.1-40.8-52c-0.4,0-0.8,0-1.2,0s-0.8,0-1.2,0c-13,0.9-40.8,40-40.8,52.1v4.6\n        c0,8,11.4,1.4,14.1,26.5c-3.4,2-5.5,5.7-5.5,9.6c0,4.9,3.2,9.1,7.9,10.6v29.1C30.7,131.2,13,90.8,27.2,54.9\n        c5.9-15.1,16.9-27.6,31.1-35.5c1.8-1,2.4-3.2,1.4-5c-0.6-1.2-1.9-1.9-3.2-1.9c-0.6,0-1.2,0.2-1.7,0.5C17.5,33.6,4,80.5,24.6,117.7\n        c10.4,18.9,28.3,32.5,49.2,37.6v-32.9c2.4,0.8,4.8,1.5,7.3,1.9v39.1c-45.9-6.1-78.1-48.2-72-94.1c0.8-6.3,2.4-12.5,4.6-18.4\n        c0.7-1.8-0.2-3.9-2-4.6c-0.4-0.2-0.9-0.3-1.4-0.3c-1.5,0-2.9,0.9-3.4,2.4C-10.9,95.5,12.9,148,60,165.7c9.1,3.4,18.6,5.3,28.3,5.7\n        v-46.1c1.3,0.1,3.7,0.1,3.7,0.1s2.4,0,3.7-0.1v46.1c50.2-2.1,89.3-44.5,87.2-94.7C182.5,67,180.6,57.5,177.2,48.4L177.2,48.4z\n        M108.8,100.3c2.9-2.9,7.7-2.9,10.6,0c2.9,2.9,2.9,7.7,0,10.6c-2.9,2.9-7.7,2.9-10.6,0c-1.4-1.4-2.2-3.3-2.2-5.3\n        C106.6,103.6,107.4,101.7,108.8,100.3L108.8,100.3z M75.2,110.9c-2.9,2.9-7.7,2.9-10.6,0s-2.9-7.7,0-10.6c2.9-2.9,7.7-2.9,10.6,0\n        c1.4,1.4,2.2,3.3,2.2,5.3C77.4,107.6,76.6,109.5,75.2,110.9z\"/>\n    </g>\n  </svg>`;\n};\n\nexport default getGkLogo;"],"mappings":"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","names":["module","__defProp","__getOwnPropDesc","__getOwnPropNames","__hasOwnProp","__copyProps","initializePushstateEvent","element","initializePushstateEvent"]}